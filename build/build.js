(()=>{"use strict";const e=document.getElementById("optionsInputContainer"),t=document.getElementById("downloadImageBtn"),n=document.getElementById("loadImageBtn"),o=document.getElementById("addTxtContainer"),l=document.getElementById("txtCounter");let i=!1;const r=e=>{if("none"!==e){let t=e.split("(")[1].split(")")[0].split(","),n=Math.round(Math.atan2(t[1],t[0])*(180/Math.PI));return n<0?n+360:n}return 0},a=(e,t)=>Number(e[t].slice(0,-2)),d=document.getElementById("generatorContainer"),u=document.getElementById("generatorZone"),c=document.getElementById("optionsInputContainer"),s=document.getElementById("deleteTxtButton");let m=document.getElementById("txtCounter");function p(e,t){let n=null;return function(...o){n||(n=setTimeout((()=>{e(...o),clearTimeout(n),n=null}),t))}}s.addEventListener("click",(e=>{let t=u.querySelector(".active");t.parentNode.removeChild(t);let n=Number(m.textContent);m.textContent=n-1,n--,0==n&&(e.target.disabled=!0),c.innerHTML=""})),document.getElementById("memeGenerator");const f=document.getElementById("loadImageBtn"),x=document.getElementById("downloadImageBtn");document.getElementById("addTxtButton").addEventListener("click",(function(e){if(m.textContent=Number(m.textContent)+1,!i)return;"0"===m.textContent?s.disabled=!0:s.disabled=!1,e.clientX,u.getBoundingClientRect().left,e.clientY,u.getBoundingClientRect().top;let t=document.createElement("div");t.classList.add("input_generator-txt"),t.style.fontSize="40px",t.style.left="230px",t.style.top="230px",t.textContent="Text",t.spellcheck=!1,t.onmousedown=function(e){let n=e.clientX-t.getBoundingClientRect().left,o=e.clientY-t.getBoundingClientRect().top;const l=e=>{let l=e.clientX-n-memeGenerator.getBoundingClientRect().left,i=e.clientY-o-memeGenerator.getBoundingClientRect().top;l<-30&&(l=-30);let r=memeGenerator.offsetWidth-t.offsetWidth;l>r+30&&(l=r+30),i<-30&&(i=-30);let a=memeGenerator.offsetHeight-t.offsetHeight;i>a+30&&(i=a+30),t.style.left=l+"px",t.style.top=i+"px"},i=e=>{d.removeEventListener("mousemove",l),u.removeEventListener("mouseup",i)};d.addEventListener("mousemove",l),d.addEventListener("mouseup",i)},t.ondragstart=function(){return!1};const n=e=>{c.innerHTML="";let n=document.querySelectorAll(".input_generator-txt");for(let e of n)console.log(e),e.classList.remove("active");t.classList.add("active");let o=getComputedStyle(e.target);function l(e,t,n){function o(e){var t=e.toString(16);return 1==t.length?"0"+t:t}return"#"+o(e)+o(t)+o(n)}let i=o.color.match(/\d+/g).map((e=>Number(e))),r='\n            <div class="options_input-stroke">\n                <input type="checkbox" id="onOffStroke">\n                <label for="onOffStroke" id="onOffStrokeTxt">Сделать обводку</label>\n                <input type="color" id="inputStrokeColor" class="hidden" value = #aaa>\n            </div>';if("none"!==o.textShadow){let e=o.textShadow;r=`\n            <div class="options_input-stroke">\n                <input type="checkbox" id="onOffStroke" checked>\n                <label for="onOffStroke" id="onOffStrokeTxt">Цвет обводки: </label>\n                <input type="color" id="inputStrokeColor" value = ${l(...e.slice(0,e.indexOf(")",0)+1).match(/\d+/g).map((e=>Number(e))))}>\n            </div>`}c.insertAdjacentHTML("beforeend",`\n\n        <div class="options_input-txt">\n            <label for="inputTxt">Введите текст: </label>\n            <input type="text" id="inputTxt" value="${t.textContent}">\n        </div>\n        <div class="options_input-color">\n                    <label for="inputTxtColor">Выберите цвет текста: </label>\n                    <input type="color" id="inputTxtColor" value = ${l(...i)}>\n        </div>\n        ${r}\n        <div class="options_input-range">\n            <label for="inputTxtFontSize">Размер текста: </label>\n            <input type="range" id="inputTxtFontSize" name="cowbell" min="16" max="70" value="${((e,t)=>Number(e[t].slice(0,-2)))(o,"fontSize")}" step="2" />\n        </div>\n        <div class="options_input-range">\n            <label for="inputTxtRotate">Поверните: </label>\n            <input type="range" id="inputTxtRotate" name="cowbell" min="-180" max="180" value="${function(e){if("none"!==e){let t=e.split("(")[1].split(")")[0].split(","),n=Math.round(Math.atan2(t[1],t[0])*(180/Math.PI));return n<0?n+360:n}return 0}(o.transform)}" step="10" />\n        </div>\n        `);let a=c.querySelector("#inputTxt"),d=c.querySelector("#inputTxtColor"),u=c.querySelector("#inputTxtFontSize"),s=c.querySelector("#inputTxtRotate"),m=c.querySelector("#inputStrokeColor"),f=c.querySelector("#onOffStroke"),x=c.querySelector("#onOffStrokeTxt");a.addEventListener("input",p((e=>{t.innerText=e.target.value}),50)),d.addEventListener("input",p((e=>{t.style.color=e.target.value}),50)),u.addEventListener("input",(e=>{t.style.fontSize=e.target.value+"px"})),s.addEventListener("input",(e=>{t.style.transform=`rotate(${e.target.value}deg)`})),m.addEventListener("input",(e=>{let n=e.target.value;t.style.textShadow=`${n} -1px -1px 0, ${n} 1px -1px 0, ${n} -1px 1px 0, ${n} 1px 1px 0`})),f.addEventListener("input",p((e=>{if(!e.target.checked)return t.style.textShadow="none",x.textContent="Сделать обводку",void m.classList.add("hidden");x.textContent="Цвет обводки: ",m.classList.remove("hidden"),t.style.textShadow=`${m.value} -1px -1px 0, ${m.value} 1px -1px 0, ${m.value} -1px 1px 0, ${m.value} 1px 1px 0`}),50))};t.addEventListener("mousedown",n),u.append(t),n(e)})),f.addEventListener("change",(function(e){var l=new FileReader;if(l.onload=function(e){var t=new Image;t.onload=function(){let e=memeGenerator.getContext("2d");memeGenerator.width=500,memeGenerator.height=500;var n=memeGenerator.width/t.width,o=memeGenerator.height/t.height,l=t.width*n,i=t.height*o;e.clearRect(0,0,memeGenerator.width,memeGenerator.height),e.drawImage(t,0,0,l,i)},t.src=e.target.result},!/(\.jpg|\.jpeg|\.png|\.gif)/.test(e.target.files[0].name))return alert("Загрузите изображение"),n.value="",!1;l.readAsDataURL(e.target.files[0]),t.disabled=!1,i=!0,o.classList.remove("hidden")})),x.addEventListener("click",(function(i){!function(){let e=document.querySelectorAll(".input_generator-txt");for(let t of e){let e=memeGenerator.getContext("2d"),n=getComputedStyle(t);if(e.font=`${n.fontSize} Impact`,e.fillStyle=n.color,"none"===n.transform){if(e.strokeStyle="black",e.fillText(t.textContent,a(n,"left"),a(n,"top")+t.clientHeight),"none"!==n.textShadow){let o=n.textShadow;e.strokeStyle=o.slice(0,o.indexOf(")",0)+1),e.strokeText(t.textContent,a(n,"left"),a(n,"top")+t.clientHeight)}}else{e.save();let o=r(n.transform)*Math.PI/180;if(e.translate(a(n,"left")+t.clientWidth/2,a(n,"top")+t.clientHeight/2),e.rotate(o),e.fillText(t.textContent,t.clientWidth/2*-1,+t.clientHeight/2),"none"!==n.textShadow){let o=n.textShadow;e.strokeStyle=o.slice(0,o.indexOf(")",0)+1),e.strokeText(t.textContent,t.clientWidth/2*-1,+t.clientHeight/2)}e.restore()}}}();let d=memeGenerator.toDataURL();const u=document.createElement("a");u.href=d,u.download="funy-meme",u.click(),u.remove(),memeGenerator.getContext("2d").clearRect(0,0,memeGenerator.width,memeGenerator.height),n.value="",t.disabled=!1;let c=document.querySelectorAll(".input_generator-txt");for(let e of c)e.parentNode.removeChild(e);e.innerHTML="",o.classList.add("hidden"),l.textContent=0}))})();